#!/usr/bin/false This file is meant to be sourced
# ========================================================================
# Copyright (c) 1994-2016 T. R. Burghart.
# 
# Permission to use, copy, modify, and/or distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
# 
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
# ========================================================================
#
# System-wide profile for Bourne-ish shells on Linux.
#
# This needs to work for sh, bash, ksh, and zsh, though zsh handles sourcing
# the shrc file on its own.
#

if [ -z "$EUID" ]
then
    EUID="$(/usr/bin/id -u)"
fi
if [ -z "$UID" ]
then
    UID="$(/usr/bin/id -ru)"
fi
if [ -z "$LOGNAME" ]
then
    if [ -n "$USER" ]
    then
        LOGNAME="$USER"
    else
        LOGNAME="$(/usr/bin/id -un)"
    fi
fi
if [ -z "$USER" ]
then
    USER="$LOGNAME"
fi
MAIL="/var/spool/mail/$(/usr/bin/id -un)"

HOSTNAME="$(/usr/bin/hostname 2>/dev/null)"
HISTSIZE=1000
if [ "$HISTCONTROL" = 'ignorespace' ]
then
    HISTCONTROL=ignoreboth
else
    HISTCONTROL=ignoredups
fi

# the standard Linux profile is lenient with non-system umasks, but I'm not
umask 022

# pathmunge is an abomination, just be smart
# system /sbin should ALWAYS come before local variants for the superuser, but
# normal users may want local overrides first, which makes it easier anyway
for __prf in /usr/local/sbin /sbin
do
    case "$PATH" in
        *:$__prf:*|$__prf:*|*:$__prf)
            ;;
        *)
            if [ "$EUID" = "0" ]
            then
                PATH="$__prf:$PATH"
            else
                PATH="$PATH:$__prf"
            fi
            ;;
    esac
done

export HISTCONTROL HISTSIZE HOSTNAME LOGNAME MAIL PATH USER

# strictly for per-system global environment overrides
if [ -r /usr/local/etc/env.local ]
then
    . /usr/local/etc/env.local
fi

# see if we can assure that $SHELL is set to something sane
if [ -n "$BASH_VERSION" ]
then
    __prf_sh=bash
elif [ -n "$KSH_VERSION" ]
then
    __prf_sh=ksh
elif [ -n "$ZSH_VERSION" ]
then
    __prf_sh=zsh
else
    __prf_sh=sh
fi
set -x
if [ -z "$SHELL" -o ! -f "$SHELL" ]
then
    __prf_fn=`basename "$SHELL"`
    if [ "$__prf_fn" != "$__prf_sh" -a "$__prf_fn" != "r$__prf_sh" ]
    then
        for __prf in /bin/$__prf_sh /usr/bin/$__prf_sh `which $__prf_sh`
        do
            if [ -f "$__prf" -a -x "$__prf" ]
            then
                SHELL="$__prf"
                export SHELL
                break
            fi
        done
    done
    unset __prf_fn
fi
set +x

# default Linux profiles source the shell rc file even in non-interactive
# mode, but that's stupid and Homey don't play that game
# if you're relying on paths being augmented in /etc/profile.d scripts for
# non-interactive scripts, you're doing it wrong
if [ -n "$PS1" ]
then
    if [ $__prf_sh = zsh -a -r /etc/zshrc ]
    then
        true
    elif [ -r /etc/${__prf_sh}rc ]
    then
        . /etc/${__prf_sh}rc
    elif [ -r /etc/shrc ]
    then
        . /etc/shrc
    fi
fi

unset __prf __prf_sh
